<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>数据可视化平台</title>
    <link rel="stylesheet" href="./css/style.css">
    <script src="./js/echarts.min.js"></script>
    <link rel="stylesheet" href="https://openlayers.org/en/v3.20.1/css/ol.css" type="text/css">
    <script src="https://openlayers.org/en/v3.20.1/build/ol.js" type="text/javascript"></script>
</head>
<body>
<!-- 导航栏 -->
<nav>
    <div class="logo">
        <a href="#">钻孔数据可视化平台</a>
    </div>
    <ul class="nav-links">
        <li><a href="#">首页</a></li>
        <li><a href="#">数据分析</a></li>
        <li><a href="#">可视化展示</a></li>
        <li><a href="#">报告导出</a></li>
        <li><a href="#">设置</a></li>
    </ul>
</nav>

<!-- 主体内容区域 -->
    <section class="data-visualization">
        <h2>研究区域</h2>
        <div id="mapDiv" class="visual-content">

        </div>
    </section>
<div id="wrapper">
    <div id="location"></div>
    <div id="scale">比例尺：1:</div>
</div>
<div id="pointtable"></div>
    <section class="data-visualization">
        <h2>图表展示</h2>
        <div id="dataDiv" class="visual-content">

        </div>
    </section>

<script>
    var extent=[447473.9310505188,3565849.0686830175,447643.00895286,3566068.461321368]

    var tiled = [
        new ol.layer.Tile({
            source: new ol.source.TileWMS({
                url: 'http://localhost:8090/geoserver/drilldata/wms',
                params: {
                    'LAYERS': 'drilldata:drillpoints',
                    'TILED': false
                },
                serverType: 'geoserver'
            })
        })
    ];
    var projection = new ol.proj.Projection({
        code: 'EPSG:4549',
        units: 'm',
        axisOrientation: 'neu',
        global: false
    });
    var mousePositionControl = new ol.control.MousePosition({
        className: 'custom-mouse-position',
        target: document.querySelector("#wrapper #location"),
        coordinateFormat: ol.coordinate.createStringXY(5),
        undefinedHTML: '&nbsp;'
    });
    var map = new ol.Map({
        layers: tiled,
        target: 'mapDiv',
        view: new ol.View({
            projection: projection
        }),
        controls: ol.control.defaults().extend([mousePositionControl]),
    });
    map.getView().fit(extent, map.getSize());
    map.getView().on('change:resolution', function(evt) {
        var resolution = evt.target.get('resolution');
        var units = map.getView().getProjection().getUnits();
        var dpi = 25.4 / 0.28;
        var mpu = ol.proj.METERS_PER_UNIT[units];
        var scale = resolution * mpu * 39.37 * dpi;
        if (scale >= 9500 && scale <= 950000) {
            scale = Math.round(scale / 1000) + "K";
        } else if (scale >= 950000) {
            scale = Math.round(scale / 1000000) + "M";
        } else {
            scale = Math.round(scale);
        }
        document.getElementById('scale').innerHTML = "比例尺：1:" + scale;
    });
    map.on('singleclick', function(evt) {
        document.getElementById('pointtable').innerHTML = "Loading... please wait...";
        var view = map.getView();
        var viewResolution = view.getResolution();
        var source = tiled[0].getSource();
        var url = source.getGetFeatureInfoUrl(
            evt.coordinate, viewResolution, view.getProjection(),
            {'INFO_FORMAT': 'text/html', 'FEATURE_COUNT': 50});
        if (url) {
            document.getElementById('pointtable').innerHTML = '<iframe seamless src="' + url + '"></iframe>';
        }
    });
</script>
<script src="./js/drawChart.js"></script>

<!-- 页脚 -->
<footer>
    <div class="footer-links">
        <a href="#">关于我们</a>
        <a href="#">联系我们</a>
        <a href="#">常见问题</a>
        <a href="#">服务协议</a>
        <a href="#">隐私政策</a>
    </div>
    <div class="footer-info">
        <p>© 2023 NJU-GEO. All Rights Reserved.</p>
    </div>
</footer>
</body>
</html>
